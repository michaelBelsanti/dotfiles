{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./lib/environment/utils/api.js","webpack:///./lib/environment/utils/messaging.js","webpack:///./lib/environment/background/messaging.js","webpack:///./lib/environment/background/permissions.js","webpack:///./lib/environment/background/permissions/prompt.entry.js"],"names":["apiToPromise","func","args","Promise","resolve","reject","results","chrome","runtime","lastError","Error","message","length","MessageHandlerError","constructor","stack","createMessageHandler","_sendMessage","errorOnUnrecognizedTypes","listeners","Map","_handleMessage","type","data","sendResponse","context","listener","get","error","response","e","console","then","sendMessage","newData","addListener","callback","has","set","tabs","obj","tabId","onMessage","sender","handleMessage","operation","permissions","origins","contains","request","catch","makePromptWindow","url","URL","location","origin","searchParams","JSON","stringify","width","height","left","Math","floor","screen","top","id","windows","create","href","updateListener","updates","stopListening","result","parse","remove","removeListener","onUpdated","onRemoved","button","document","body","querySelector","addEventListener","alert","focus"],"mappings":"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","file":"prompt.entry.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/* @flow */\n\nexport function apiToPromise(func: (...args: mixed[]) => void): (...args: mixed[]) => Promise<any> {\n\treturn (...args) =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tfunc(...args, (...results) => {\n\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\treject(new Error(chrome.runtime.lastError.message));\n\t\t\t\t} else {\n\t\t\t\t\tresolve(results.length > 1 ? results : results[0]);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n}\n","/* @flow */\n\ntype MessagePayload = {|\n\ttype: string,\n\tdata?: mixed,\n|};\n\ntype ResponsePayload = {|\n\tdata?: mixed,\n\terror?: {| message: string, stack: string |},\n|};\n\ntype InternalMessageSender<MsgCtx> = (msg: MessagePayload, context: MsgCtx) => Promise<ResponsePayload>;\n\ntype InternalMessageHandler<ListenerCtx> = (msg: MessagePayload, sendResponse: (response: ResponsePayload) => void, context: ListenerCtx) => boolean;\n\nexport type MessageSender<MsgCtx> = (type: string, data: mixed, context: MsgCtx) => Promise<any>;\n\nexport type AddListener<Ctx> = (type: string, callback: ListenerCallback<Ctx>) => void;\n\ntype ListenerCallback<Ctx> = (data: any, context: Ctx) => Promise<mixed> | mixed;\n\nclass MessageHandlerError extends Error {\n\tconstructor(message, stack) {\n\t\tsuper();\n\t\tthis.message = message;\n\t\tthis.stack = stack;\n\t}\n}\n\nexport function createMessageHandler<MsgCtx, ListenerCtx>(_sendMessage: InternalMessageSender<MsgCtx>, errorOnUnrecognizedTypes: boolean = false): {|\n\t_handleMessage: InternalMessageHandler<ListenerCtx>,\n\tsendMessage: MessageSender<MsgCtx>,\n\taddListener: AddListener<ListenerCtx>,\n|} {\n\tconst listeners = new Map();\n\n\tfunction addListener(type, callback) {\n\t\tif (listeners.has(type)) {\n\t\t\tthrow new Error(`Listener for \"${type}\" already exists.`);\n\t\t}\n\t\tlisteners.set(type, callback);\n\t}\n\n\tasync function sendMessage(type, data, context) {\n\t\tconst { data: newData, error } = await _sendMessage({ type, data }, context);\n\t\tif (error) {\n\t\t\tthrow new MessageHandlerError(error.message, `${error.stack}\\n    at target's \"${type}\" handler`);\n\t\t} else {\n\t\t\treturn newData;\n\t\t}\n\t}\n\n\tfunction _handleMessage({ type, data }, sendResponse, context) {\n\t\tconst listener = listeners.get(type);\n\t\tif (!listener) {\n\t\t\tif (errorOnUnrecognizedTypes) {\n\t\t\t\tsendResponse({ error: { message: `Unrecognised message type: ${type}`, stack: '' } });\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tlet response;\n\n\t\ttry {\n\t\t\tresponse = listener(data, context);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tsendResponse({ error: { message: e.message, stack: e.stack } });\n\t\t\treturn false;\n\t\t}\n\n\t\tif (response instanceof Promise) {\n\t\t\tresponse\n\t\t\t\t.then(\n\t\t\t\t\tdata => sendResponse({ data }),\n\t\t\t\t\te => {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\tsendResponse({ error: { message: e.message, stack: e.stack } });\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t// true = response will be handled asynchronously (needed for Chrome)\n\t\t\treturn true;\n\t\t} else {\n\t\t\tsendResponse({ data: response });\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn {\n\t\t_handleMessage,\n\t\tsendMessage,\n\t\taddListener,\n\t};\n}\n","/* @flow */\n\nimport { createMessageHandler } from '../utils/messaging';\nimport { apiToPromise } from '../utils/api';\n\nconst _sendMessage = apiToPromise(chrome.tabs.sendMessage);\n\nconst {\n\t_handleMessage,\n\tsendMessage,\n\taddListener,\n} = createMessageHandler((obj, tabId) => _sendMessage(tabId, obj));\n\nchrome.runtime.onMessage.addListener((obj, sender, sendResponse) => _handleMessage(obj, sendResponse, sender));\n\nexport {\n\tsendMessage,\n\taddListener,\n};\n","/* @flow */\n\nimport { apiToPromise } from '../utils/api';\nimport { addListener } from './messaging';\n\naddListener('permissions', handleMessage);\n\nexport function handleMessage({ operation, permissions, origins }: *) {\n\tswitch (operation) {\n\t\tcase 'contains':\n\t\t\treturn apiToPromise(chrome.permissions.contains)({ permissions, origins });\n\t\tcase 'request':\n\t\t\treturn apiToPromise(chrome.permissions.request)({ permissions, origins })\n\t\t\t\t.catch(() => makePromptWindow({ permissions, origins }));\n\t\tdefault:\n\t\t\tthrow new Error(`Invalid permissions operation: ${operation}`);\n\t}\n}\n\nasync function makePromptWindow({ permissions, origins }) {\n\tconst url = new URL('prompt.html', location.origin);\n\turl.searchParams.set('permissions', JSON.stringify(permissions));\n\turl.searchParams.set('origins', JSON.stringify(origins));\n\n\tconst width = 630;\n\tconst height = 255;\n\t// Display popup on middle of screen\n\tconst left = Math.floor(screen.width / 2 - width / 2);\n\tconst top = Math.floor(screen.height / 2 - height / 2);\n\n\tconst { tabs: [{ id }] } = await apiToPromise(chrome.windows.create)({ url: url.href, type: 'popup', width, height, left, top });\n\n\treturn new Promise(resolve => {\n\t\tfunction updateListener(tabId, updates) {\n\t\t\tif (tabId !== id) return;\n\n\t\t\tconst url = updates.url && new URL(updates.url);\n\t\t\tif (url && url.searchParams.has('result')) {\n\t\t\t\tstopListening();\n\t\t\t\tconst result = url.searchParams.get('result');\n\t\t\t\tif (!result) return;\n\t\t\t\tresolve(JSON.parse(result));\n\t\t\t\tapiToPromise(chrome.tabs.remove)(id);\n\t\t\t}\n\t\t}\n\n\t\tfunction removeListener(tabId) {\n\t\t\tif (tabId !== id) return;\n\t\t\tstopListening();\n\t\t\tresolve(false);\n\t\t}\n\n\t\tfunction stopListening() {\n\t\t\tchrome.tabs.onUpdated.removeListener(updateListener);\n\t\t\tchrome.tabs.onRemoved.removeListener(removeListener);\n\t\t}\n\n\t\tchrome.tabs.onUpdated.addListener(updateListener);\n\t\tchrome.tabs.onRemoved.addListener(removeListener);\n\t});\n}\n","/* @flow */\n\nimport { handleMessage } from '../permissions';\n\nconst url = new URL(location.href);\n\nconst button = document.body.querySelector('#request');\nbutton.addEventListener('click', async () => {\n\ttry {\n\t\tconst result = await handleMessage({\n\t\t\toperation: 'request',\n\t\t\tpermissions: JSON.parse(url.searchParams.get('permissions') || '[]'),\n\t\t\torigins: JSON.parse(url.searchParams.get('origins') || '[]'),\n\t\t});\n\t\turl.searchParams.set('result', JSON.stringify(result));\n\t\tlocation.href = url.href;\n\t} catch (e) {\n\t\talert(`An error occured: ${e.message}`); // eslint-disable-line no-restricted-globals\n\t}\n});\n\n// Focus, so pressing space / enter can be used as an alternative to clicking the button\nbutton.focus();\n"],"sourceRoot":""}