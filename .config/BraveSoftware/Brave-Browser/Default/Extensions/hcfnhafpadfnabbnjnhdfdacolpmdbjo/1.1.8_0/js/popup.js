const NOTIFICATIONS=[{id:"v3za9vcy6rji3kx3t32wzjdqi7ztqmxw",priority:1e3,title:"",message:"If you like Ultimate Volume Booster please rate it on <a href=\"https://chrome.google.com/webstore/detail/audio-booster/kaganfmfchlbdifnggkfjjkccecmeklk/reviews\" target=\"_blank\" tabindex=\"-1\">Chrome Web Store</a> to let me know that. If you don't want to - it's ok. Thank you for your feedback and have a nice day! \u2600\uFE0F",dateFrom:"2018-02-01",dateTo:"2029-12-31",minDaysFromInstallation:1},{id:"cvifms5exdmqy2g3ar4kzhmxi4zepvvq",priority:750,title:"Tip: custom keyboard shortcut",message:"Just type <strong>chrome://extensions/shortcuts</strong> in the address bar and set your own shortcut to open Ultimate Volume Booster.",dateFrom:"2018-08-01",dateTo:"2029-12-31",minDaysFromInstallation:3},{id:"h6s5u6eqgjpxwqasujret4vz2pnkj945",priority:500,title:"Tip: use keys 0 - 6 to adjust volume",message:"Right after opening Ultimate Volume Booster press keys 0&nbsp;-&nbsp;6 to change volume from 0&nbsp;% to 600&nbsp;% respectively.",dateFrom:"2018-08-01",dateTo:"2029-12-31",minDaysFromInstallation:7},{id:"fms5exdvb8b9e6kk4bc2pckq3zcvifnr",priority:175,title:"",message:"If you like Ultimate Volume Booster please rate it on <a href=\"https://chrome.google.com/webstore/detail/audio-booster/kaganfmfchlbdifnggkfjjkccecmeklk/reviews\" target=\"_blank\" tabindex=\"-1\">Chrome Web Store</a> to let me know that. If you don't want to - it's ok. Thank you for your feedback and have a nice day! \u2600\uFE0F",dateFrom:"2018-02-01",dateTo:"2029-12-31",minDaysFromInstallation:14},{id:"b8b9uivc4yde6kk4bc2pckq3zjt2vfnr",priority:100,title:"",message:"If you like Ultimate Volume Booster please rate it on <a href=\"https://chrome.google.com/webstore/detail/audio-booster/kaganfmfchlbdifnggkfjjkccecmeklk/reviews\" target=\"_blank\" tabindex=\"-1\">Chrome Web Store</a> to let me know that. If you don't want to - it's ok. Thank you for your feedback and have a nice day! \u2600\uFE0F",dateFrom:"2018-02-01",dateTo:"2029-12-31",minDaysFromInstallation:30},{id:"e6kk46kk4bc2pcxdvb8b9kq3zjt2vfnr",priority:50,title:"",message:"If you like Ultimate Volume Booster please rate it on <a href=\"https://chrome.google.com/webstore/detail/audio-booster/kaganfmfchlbdifnggkfjjkccecmeklk/reviews\" target=\"_blank\" tabindex=\"-1\">Chrome Web Store</a> to let me know that. If you don't want to - it's ok. Thank you for your feedback and have a nice day! \u2600\uFE0F",dateFrom:"2018-02-01",dateTo:"2029-12-31",minDaysFromInstallation:90}];class Popup{constructor(){this.gainValueInput=document.querySelector("#volume-slider"),this.volumeCurrent=document.querySelector("#volume-current"),this.tabsTitle=document.querySelector(".tabs__title"),this.tabsList=document.querySelector(".tabs__list"),this.notification__close=document.querySelector(".js-notification__close"),this.currentTabId=null,this.storage=null,this.handleDocumentKeyPress=this.handleDocumentKeyPress.bind(this),this.run()}run(){this.setGainValue(),this.showPlayingTabs(),this.initListeners(),this.initStorage().then(()=>{this.startNotifications()})}setGainValue(){this.getCurrentTabId().then(b=>{chrome.runtime.sendMessage({action:"popup__get-gain-value",tabId:b},c=>{if(!c||!c.gainValue)return void(this.volumeCurrent.textContent=100);const a=parseInt(100*c.gainValue,10);this.gainValueInput.value=a,this.volumeCurrent.textContent=a,chrome.runtime.sendMessage({action:"popup__tab-gain-change",gainValue:a},()=>{})})})}getCurrentTabId(){return new Promise(c=>{chrome.tabs.query({active:!0,currentWindow:!0},a=>{chrome.runtime.lastError||(this.currentTabId=a[0].id,c(this.currentTabId))})})}showPlayingTabs(){chrome.tabs.query({audible:!0},b=>{b.sort((a,b)=>b.id-a.id),this.tabsTitle.textContent=b.length?"Playing sound currently on tabs":"No playing sound currently on tabs",b.forEach(c=>{const a=document.querySelector("#template-tab").content;a.querySelector(".tab").dataset.tabId=c.id,a.querySelector(".tab__icon-image").src=c.favIconUrl,a.querySelector(".tab__title").textContent=c.title,this.tabsList.appendChild(document.importNode(a,!0))})})}initStorage(){return new Promise(c=>{chrome.storage.local.get({usedIds:[],installationDate:null},d=>{if(!d.installationDate){d.installationDate=new Date;const b=JSON.stringify(d.installationDate);this.storage=d,this.saveToStorage({installationDate:b})}else this.storage=d,this.storage.installationDate=JSON.parse(d.installationDate);c()})})}startNotifications(){const b=this.getCurrentNotification();b&&this.showNotification(b)}showNotification(b){document.querySelector(".js-notification").classList.add("is-active"),document.querySelector(".js-notification__close").dataset.id=b.id,document.querySelector(".js-notification__title").innerHTML=b.title,document.querySelector(".js-notification__message").innerHTML=b.message}getCurrentNotification(){const a=new Date,b=new Date(this.storage.installationDate);return NOTIFICATIONS.filter(b=>a>=new Date(b.dateFrom)).filter(b=>a<=new Date(b.dateTo)).filter(a=>-1===this.storage.usedIds.indexOf(a.id)).filter(c=>c.minDaysFromInstallation<=Math.floor((a-b)/1e3/60/60/23)).sort((a,b)=>a.priority-b.priority).pop()}initListeners(){this.initDOMListeners()}initDOMListeners(){this.gainValueInput.addEventListener("input",b=>this.handleGainChange(b)),this.tabsList.addEventListener("click",b=>this.handleTabListClick(b)),this.notification__close.addEventListener("click",b=>this.closeNotification(b)),document.documentElement.addEventListener("keypress",this.handleDocumentKeyPress)}handleDocumentKeyPress(e){e.preventDefault();const a=e.key.toLowerCase(),f=+a,b=!isNaN(f);if(b){const c=100*f,a=+this.gainValueInput.max,b=+this.gainValueInput.min;return b<=c&&c<=a?(this.gainValueInput.value=c,this.volumeCurrent.textContent=c,chrome.runtime.sendMessage({action:"popup__tab-gain-change",tabId:this.currentTabId,gainValue:c}),void chrome.tabs.sendMessage(this.currentTabId,{action:"showGain",volume:c})):void 0}"r"===a&&window.location.reload()}handleGainChange(c){const a=parseInt(c.target.value);this.gainValueInput.textContent=a,this.volumeCurrent.textContent=a,chrome.runtime.sendMessage({action:"popup__tab-gain-change",tabId:this.currentTabId,gainValue:a}),chrome.tabs.sendMessage(this.currentTabId,{action:"showGain",volume:a})}handleTabListClick(e){e.preventDefault();const a=e.target,b=a.closest(".tab"),c=parseInt(b.dataset.tabId,10);chrome.tabs.update(c,{active:!0},a=>{chrome.windows.update(a.windowId,{focused:!0})})}closeNotification(c){const a=c.target.dataset.id;this.storage.usedIds.push(a),this.saveToStorage({usedIds:this.storage.usedIds}),c.target.closest(".notification").classList.remove("is-active"),document.querySelector("html").style.minHeight="auto"}saveToStorage(c,a=()=>{}){chrome.storage.local.set(c,()=>{a()})}}const popup=new Popup;