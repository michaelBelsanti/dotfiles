!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=184)}([,function(e,t,n){"use strict";n.d(t,"f",(function(){return o})),n.d(t,"e",(function(){return c})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return u})),n.d(t,"g",(function(){return l}));var r=n(14);const o=function(e,t={},n=[]){const r=document.createElement(e);for(const e in t){const n=t[e];if("styles"===e)for(const e in n)r.style.setProperty(e,n[e]);else r.setAttribute(e,n)}return n.forEach((e=>{e&&r.appendChild(e)})),r},c=function(e){return`https://www.amazon.com/s?k=${e=e.replace(/[\s]/g,"+")}`},a=function({host:e,pathname:t,search:n}){const r=(e.match(/[^.]+\.[^.]+$/)||[])[0];let o="external";return"amazon-adsystem.com"===r?o="ad":"amazon.com"===r&&new RegExp("^/([^/]*/)?slredirect/").test(t)?o="sponsored":"amazon.com"===r&&new RegExp("^/([^/]*/)?dp/").test(t)?o="product":"amazon.com"===r&&new RegExp("^/s/").test(t)?o="search":"amazon.com"===r&&new RegExp("^/([^/]*/)?b/").test(t)?o="category":"amazon.com"===r&&(o="amazon"),{type:o,domain:r,ref:(t.match(/ref=(.+)/)||[])[1]}},i=function(e){return["home","search","product","cart","thankyou"].find((t=>{const n=e[`${t}PagePathRegex`]||null,r=null!==location.pathname.match(n),o=document.querySelector(e[`${t}PageContainer`]),c=e[`${t}PageRequirements`];return!(!c||!r&&!o)&&c.every((e=>document.querySelector(e)))}))},s=function(e){return r(e)},u=function(e,t){const n={queries:{[t]:{}}};return e.forEach((e=>{if(e){const r=s(e);n.queries[t][r]=e}})),n},l=function(e,t){const n=e.methodFactory;e.methodFactory=function(e,r,o){const c=n(e,r,o);return function(...e){c(t,...e)}},e.setLevel(e.getLevel())}},,function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return a})),n.d(t,"f",(function(){return i})),n.d(t,"a",(function(){return s}));const r=function(e,t){return new Promise(((n,r)=>{chrome.runtime.sendMessage({type:e,...t},(e=>{n(e)}))}))},o=function(e,t,n){return r("load_query",{host:e,queryName:t,queryBundle:n})},c=function(e){return r("category_search",{searchParam:e})},a=function(){return r("get_config")},i=function(...e){r("track",{arguments:e})},s=async function(){const{productCount:e}=await r("get_purchase_meta");return e&&e>0}},function(e,t,n){var r,o;!function(c,a){"use strict";void 0===(o="function"==typeof(r=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function o(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?c:void 0!==console[r]?o(console,r):void 0!==console.log?o(console,"log"):e)}function i(t,n){for(var o=0;o<r.length;o++){var c=r[o];this[c]=o<t?e:this.methodFactory(c,t,n)}this.log=this.debug}function s(e,n,r){return function(){typeof console!==t&&(i.call(this,n,r),this[e].apply(this,arguments))}}function u(e,t,n){return a(e)||s.apply(this,arguments)}function l(e,n,o){var c,a=this,s="loglevel";function l(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&s){try{return void(window.localStorage[s]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(s)+"="+n+";"}catch(e){}}}function d(){var e;if(typeof window!==t&&s){try{e=window.localStorage[s]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(s)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?s+=":"+e:"symbol"==typeof e&&(s=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=o||u,a.getLevel=function(){return c},a.setLevel=function(n,r){if("string"==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(c=n,!1!==r&&l(n),i.call(a,n,e),typeof console===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){d()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var f=d();null==f&&(f=null==n?"WARN":n),a.setLevel(f,!1)}var d=new l,f={};d.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=f[e];return t||(t=f[e]=new l(e,d.getLevel(),d.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=p),d},d.getLoggers=function(){return f},d.default=d,d})?r.call(t,n,t,e):r)||(e.exports=o)}()},,,,,,,function(e,t,n){var r=n(42),o="object"==typeof self&&self&&self.Object===Object&&self,c=r||o||Function("return this")();e.exports=c},function(e,t,n){var r=n(57),o=n(62);e.exports=function(e,t){var n=o(e,t);return r(n)?n:void 0}},,function(e,t,n){"use strict";function r(e,t){var n,r;if(0===t.length)return e;for(n=0,r=t.length;n<r;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e<0?-2*e:e}function o(e,t,n,c){var a,i=r(r(r(e,n),(a=t,Object.prototype.toString.call(a))),typeof t);if(null===t)return r(i,"null");if(void 0===t)return r(i,"undefined");if("object"==typeof t||"function"==typeof t){if(-1!==c.indexOf(t))return r(i,"[Circular]"+n);c.push(t);var s=function(e,t,n){return Object.keys(t).sort().reduce((function(e,r){return o(e,t[r],r,n)}),e)}(i,t,c);if(!("valueOf"in t)||"function"!=typeof t.valueOf)return s;try{return r(s,String(t.valueOf()))}catch(e){return r(s,"[valueOf exception]"+(e.stack||e.message))}}return r(i,t.toString())}e.exports=function(e){return function(e,t){for(;e.length<t;)e="0"+e;return e}(o(0,e,"",[]).toString(16),8)}},,function(e,t,n){var r=n(41);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){var r=n(12)(Object,"create");e.exports=r},function(e,t,n){var r=n(71);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},,function(e,t,n){var r=n(22),o=n(58),c=n(59),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?o(e):c(e)}},function(e,t,n){var r=n(11).Symbol;e.exports=r},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},,,,,,function(e,t,n){var r=n(52),o=n(53),c=n(54),a=n(55),i=n(56);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=c,s.prototype.has=a,s.prototype.set=i,e.exports=s},,,,function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}},function(e,t,n){var r=n(12)(n(11),"Map");e.exports=r},function(e,t,n){var r=n(21),o=n(23);e.exports=function(e){if(!o(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},,function(e,t){e.exports=function(e){return function(t){return e(t)}}},,,function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(33))},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var r=n(63),o=n(70),c=n(72),a=n(73),i=n(74);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=c,s.prototype.has=a,s.prototype.set=i,e.exports=s},function(e,t,n){var r=n(12),o=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t,n){var r=n(36),o=n(46);e.exports=function(e){return null!=e&&o(e.length)&&!r(e)}},function(e,t){e.exports=function(e){return e}},,,,function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(16),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():o.call(t,n,1),--this.size,!0)}},function(e,t,n){var r=n(16);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(16);e.exports=function(e){return r(this.__data__,e)>-1}},function(e,t,n){var r=n(16);e.exports=function(e,t){var n=this.__data__,o=r(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this}},function(e,t,n){var r=n(36),o=n(60),c=n(23),a=n(43),i=/^\[object .+?Constructor\]$/,s=Function.prototype,u=Object.prototype,l=s.toString,d=u.hasOwnProperty,f=RegExp("^"+l.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!c(e)||o(e))&&(r(e)?f:i).test(a(e))}},function(e,t,n){var r=n(22),o=Object.prototype,c=o.hasOwnProperty,a=o.toString,i=r?r.toStringTag:void 0;e.exports=function(e){var t=c.call(e,i),n=e[i];try{e[i]=void 0;var r=!0}catch(e){}var o=a.call(e);return r&&(t?e[i]=n:delete e[i]),o}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,o=n(61),c=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!c&&c in e}},function(e,t,n){var r=n(11)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(64),o=n(29),c=n(35);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(c||o),string:new r}}},function(e,t,n){var r=n(65),o=n(66),c=n(67),a=n(68),i=n(69);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=c,s.prototype.has=a,s.prototype.set=i,e.exports=s},function(e,t,n){var r=n(17);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(17),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return o.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(17),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:o.call(t,e)}},function(e,t,n){var r=n(17);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var r=n(18);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(18);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(18);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var r=n(18);e.exports=function(e,t){var n=r(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this}},,,,,,,,,,function(e,t,n){var r=n(12)(n(11),"Set");e.exports=r},,,,function(e,t,n){var r=n(89),o=Math.max;e.exports=function(e,t,n){return t=o(void 0===t?e.length-1:t,0),function(){for(var c=arguments,a=-1,i=o(c.length-t,0),s=Array(i);++a<i;)s[a]=c[t+a];a=-1;for(var u=Array(t+1);++a<t;)u[a]=c[a];return u[t]=n(s),r(e,this,u)}}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t,n){var r=n(91),o=n(93)(r);e.exports=o},function(e,t,n){var r=n(92),o=n(45),c=n(48),a=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:c;e.exports=a},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t){var n=Date.now;e.exports=function(e){var t=0,r=0;return function(){var o=n(),c=16-(o-r);if(r=o,c>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},,,,,,,,,,,,,,,,,function(e,t,n){var r=n(44),o=n(187),c=n(188);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=o,a.prototype.has=c,e.exports=a},function(e,t,n){var r=n(189);e.exports=function(e,t){return!!(null==e?0:e.length)&&r(e,t,0)>-1}},function(e,t){e.exports=function(e,t,n){for(var r=-1,o=null==e?0:e.length;++r<o;)if(n(t,e[r]))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},,,,function(e,t,n){var r=n(186);e.exports=function(e){return e&&e.length?r(e):[]}},function(e,t,n){var r=n(34),o=n(195),c=n(196),a=n(197),i=c((function(e){var t=r(e,a);return t.length&&t[0]===e[0]?o(t):[]}));e.exports=i},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){n(185),e.exports=n(199)},function(e,t,n){"use strict";n.r(t);var r=n(3),o=n(1),c=n(118),a=n.n(c),i=n(119),s=n.n(i),u=n(4);Object(o.g)(u,"Lustre:");let l="",d="";const f=function(e,...t){u.error(`site: "${l}"`,`page: "${d}"`,"\n",e,"\n",...t),Object(r.f)("extension error",{eventCategory:`${l} ${d}`,eventLabel:e.message,errorStack:e.stack,errorParameters:t})};(async()=>{const{ALLOW_DISABLED_CATEGORIES:e,BATCH_HOSTNAME:t,BUILD_TARGET:n,CATEGORY_BANNER_ENABLED:c,SEARCH_BUTTONS_WITHOUT_CATEGORY_ENABLED:i,POPUP_ON_HOVER_ENABLED:p,PRODUCT_BADGE_STATES:g,PRODUCT_INFO_ENABLED:_,PRODUCT_INFO_SHOW_NO_DATA:b,SEARCH_BUTTONS_ENABLED:y,SEARCH_BUTTONS_SHOW_NO_DATA:h,SITE_HOSTNAME:m,SITE_SELECTORS:v,TOP_DEALS_BANNER_ENABLED:x}=await Object(r.b)();"production"===n?u.setLevel(u.levels.WARN,!1):u.setLevel(u.levels.TRACE,!1);const O=function(e,t){let{parentNode:n,precedingNode:r,followingNode:o}=t;e.setAttribute("data-lustre-attached",""),n=o?o.parentElement:n,n=r?r.parentElement:n;const c=r?r.nextSibling:o;if(n)return n.insertBefore(e,c),n;f(new Error(`Unable to attach node: "${e.className}"`))};let w=null,S=null;const j=function(e){S&&(S.remove(),S=null),w&&(w=null)};let L=null;const E=function(e){j();let t,n,c;e.currentTarget;L&&$(L);const a=new URL(e.data.url);a.searchParams.set("store",l),L=Object(o.f)("div",{class:"lux-Modal"},[t=Object(o.f)("div",{class:"lux-ModalLoading"},[Object(o.f)("img",{src:chrome.runtime.getURL("/assets/images/icons/logo.svg"),class:"lux-ModalLoading-Heart"})]),n=Object(o.f)("iframe",{class:"lux-Modal-Frame",src:a.toString()}),c=Object(o.f)("div",{class:"lux-Modal-CloseButton"},[document.createTextNode("×")])]);const i=document.querySelector("body");O(L,{parentNode:i}),i.classList.add("lux-Modal_hasModal"),c.addEventListener("click",(e=>{$(L)})),n.addEventListener("load",(e=>{t.remove()})),Object(r.f)("modal shown",{eventCategory:`${l} ${d}`,eventLabel:e.data.url,src:e.data.url})},$=function(e){document.querySelector("body").classList.remove("lux-Modal_hasModal"),L.remove(),L=null},k=function(e){e.contentWindow.postMessage({type:"getDimensions",source:e.src},"*")},A=function(e){k(e),window.addEventListener("resize",k.bind(this,e))},P=function(){u.debug("Resetting page");[...document.querySelectorAll("[data-lustre-attached]")].forEach((e=>{e.remove()}));[...document.querySelectorAll("[class^=lux-")].forEach((e=>{e.classList.forEach((t=>{0===t.indexOf("lux-")&&e.classList.remove(t)}))}))},N=function(e){u.debug(`Resetting component: ${e}`);[...document.querySelectorAll(e)].forEach((e=>e.remove()))},C=function({isWinner:e,score:t,isFallback:n}){return g.find((r=>{if(e)return r.isWinner;if(n)return r.isFallback;{const e=null!==r.maxScore?r.maxScore:Number.NEGATIVE_INFINITY;return(null!==r.minScore?r.minScore:Number.POSITIVE_INFINITY)<t&&t<=e}}))},I=async function(){u.debug("Initializing page"),P();const n=await Object(r.e)("get_disabled_sites");u.debug(`Evaluating hostname: ${location.hostname}`);const f=location.hostname.split(".").map(((e,t,n)=>n.slice(t).join("."))),g=f.find((e=>v[e])),h=v[g],L=s()(f,n)[0];if(L&&u.debug(`Domain disabled: ${L}`),h||u.debug(`Domain not supported: ${location.hostname}`),L||!h)return void Object(r.e)("set_extension_state",{enabled:!1,domain:g});u.debug(`Domain enabled: ${g}`),Object(r.e)("set_extension_state",{enabled:!0,domain:g}),l=h.siteName;const E=new URLSearchParams(location.search),$=document.querySelector(h.searchInput),I=E.get(h.searchParam)||($?$.value:null),T=h.searchAnalytics,F=document.querySelector(h.homePageContainer),R=document.querySelector(h.searchPageContainer),B=document.querySelector(h.productPageContainer),q=document.querySelector(h.cartPageContainer),D=document.querySelector(h.thankyouPageContainer),M=document.querySelector(h.orderConfirmationContainer);if(d=Object(o.d)(h),!d)return void u.debug("Page type not detected");u.debug(`Page type detected: ${d}`),I&&"search"===d&&!1!==T&&Object(r.f)("search",{eventCategory:`${l} ${d}`,eventLabel:I,searchParam:I});const z=function(e){const t=Object(o.c)(e.currentTarget);Object(r.f)("clicked search link",{eventCategory:`${l} ${d}`,eventLabel:t.type,searchParam:I,...t})};R&&I&&"search"===d&&R.querySelectorAll("a[href]").forEach((e=>{e.addEventListener("click",z)}));const U=function(e){const t=e.match(/\/([A-Z0-9]{10})(\/|\?|#|$)/);return t?t[1]:null},H=function(e){const t=function(e){const t=e.matches(".a-price")?e:e.querySelector(".a-price");if(!t)return null;const n=t.closest("a");return n?decodeURIComponent(n.href):null}(e);if(!t)return null;const n=U(t);return n?{store:l,product_sku:n}:null},W=async function(e){let t=Object.keys(e.queries.product_scores_lookup).reduce(((t,n)=>{const r=e.queries.product_scores_lookup[n],o=e.responses.product_scores_lookup[n];return t[r.product_sku]={sku:r.product_sku,product_type_id:o.product_type_id},t}),{});Object(r.e)("set_lookups",{lookups:t})},G=async function(e,t){let n=Object.keys(e.queries.product_scores_lookup).reduce(((n,r)=>{const o=e.responses.product_scores_lookup[r],c=X(r,e,t);if(c){const t=c.ml_category_id,r=e.entities.ml_category[t],a=c.is_winner,i=a?1:void 0,s=c.score,u=C({isWinner:a,score:s,isFallback:!1}).text;n[o.product_type_id]={product_type_id:o.product_type_id,category_name:r.url_slug,prediction_time:Date.now(),rank:i,score:s,label:u}}return n}),{});Object(r.e)("set_predictions",{predictions:n})},Y=function(e,t){if(!t.attributes||!t.attributes.ml_category||!t.attributes.ml_category.ml_category_ready_status_obj)return u.warn("Category ready obj attribute not available"),!1;const n=t.attributes.ml_category.ml_category_ready_status_obj;return n&&n[e]&&n[e].is_ready},V=(e,t)=>{if(!t.attributes||!t.attributes.ml_category||!t.attributes.ml_category.ml_category_sub_category_ids)throw new Error("Sub category ids attribute not available");const n=t.attributes.ml_category.ml_category_sub_category_ids[e];return n&&n.length>0},X=function(t,n,r){const o=e,c=n.responses.product_scores_lookup[t].product_category_scores_query_id;if(!c)return;const a=n.responses.product_category_scores[c]||[];let i;return r&&!V(r,n)&&(o||Y(r,n))&&(i=a.find((e=>e.ml_category_id===r))),i||(i=a.find((e=>{const t=e.ml_category_id;return!V(t,n)&&(o||Y(t,n))}))),i},J=function(e,t){return Object(o.f)("div",{class:"lux-Button","data-id":t||""},[Object(o.f)("div",{class:"lux-ButtonLoading"},[Object(o.f)("img",{src:chrome.runtime.getURL("/assets/images/icons/logo.svg"),class:"lux-ButtonLoading-Heart lux-ModalLoading-Heart lux-ModalLoading-Heart_small"}),Object(o.f)("img",{src:chrome.runtime.getURL("/assets/images/placeholder-badge.svg"),class:"lux-ButtonLoadingBadge"})]),Object(o.f)("img",{src:`${m}/api/product-rating-badge?product_id=${e}`,class:"lux-Badge"})])},Q=function(e,t,n,c,a,i,s){let u=null;const f=function(e,t,n,c,a,i,s){return async u=>{if(!e||!t)return;let f,g,_,b=u.currentTarget||u.target;if(w===b)return void(p&&u.stopPropagation());j(),w=b;const y=c?`&price_intent=${c}`:"",h=n?`&product_price=${n}`:"",v=await Object(r.a)()?"&ext_usr_ps=true":"";S=Object(o.f)("div",{class:"lux-Popup","data-testid":"product-popup"},[Object(o.f)("div",{class:"lux-Popup-Content"},[g=Object(o.f)("div",{class:"lux-FrameLoading"},[Object(o.f)("img",{src:chrome.runtime.getURL("/assets/images/icons/logo.svg"),class:"lux-ModalLoading-Heart lux-ModalLoading-Heart_medium"})]),f=Object(o.f)("iframe",{class:"lux-Popup-Frame",style:"opacity: 0;",src:`${m}/plugin/product?category_name=${e}&product_node_id=${t}${y}${h}&store=${l}${v}`,id:"lux-product-popup",title:"Lustre product popup"})]),_=Object(o.f)("div",{class:"lux-Popup-Tail"})]),O(S,{parentNode:document.querySelector("body")}),f.addEventListener("load",(e=>{k(f)}));const x=S.getBoundingClientRect(),L=w.getBoundingClientRect(),E=window.scrollX+L.x+L.width/2-x.width/2,$=window.scrollY+L.y+L.height,A=document.querySelector("body").clientWidth-x.width,P=Math.min(Math.max(E,0),A),N=$,I=window.scrollX+L.x+L.width/2-P;S.setAttribute("style",`left: ${P}px; top: ${N}px;`),_.setAttribute("style",`left: ${I}px;`);const T=C({isWinner:i,score:s,isFallback:!1}),F=T&&T.text;return Object(r.f)("badge popup shown",{eventCategory:`${l} ${d}`,eventLabel:F,badgeLabel:F,categoryName:e,productNodeId:t,searchParam:a}),u.stopPropagation(),!1}}(t,n,c,a,I,i,s);e.addEventListener("click",f),p&&(e.addEventListener("mouseenter",(e=>{w||(clearTimeout(u),u=setTimeout((()=>{w||f(e)}),500))})),e.addEventListener("mouseleave",(e=>{clearTimeout(u)})))};if(F&&"home"===d&&(u.debug("Initialize home page features"),x&&(h.topDealsPrecedingSibling||h.topDealsFollowingSibling))){let e;u.debug("Initialize top deals feature");const t=await Object(r.a)()?"&ext_usr_ps=true":"";N(".lux-Banner");const n=Object(o.f)("div",{class:"lux-Banner lux-FrameContainer",styles:h.topDealsContainerStyles},[Object(o.f)("div",{class:"lux-FrameLoadingImage"},[Object(o.f)("img",{src:chrome.runtime.getURL("/assets/images/logo-load-in.gif")})]),e=Object(o.f)("iframe",{class:"lux-Banner-Frame",src:`${m}/plugin/top-deals?store=${l}${t}`,id:"lux-deals-banner",title:"Lustre deals banner"})]);e.addEventListener("load",(t=>{A(e),n.classList.add("loaded")})),u.debug("Attach top deals feature"),O(n,{precedingNode:F.querySelector(h.topDealsPrecedingSibling),followingNode:F.querySelector(h.topDealsFollowingSibling)})}if(R&&"search"===d&&!I&&Object(r.f)("search parameter unknown",{eventCategory:`${l} ${d}`,url:window.location.href,searchParam:I}),R&&"search"===d&&I){u.debug("Initialize search page features");const n=await Object(r.d)(I),s=function(t,n){let r;const o=Object.keys(t.entities.ml_category);if(t.attributes&&t.attributes.ml_category&&(r=o.find((e=>Y(e,t)))),e){const e=t.responses.category_search,c=Object.keys(e)[0],a=o.find((e=>{const r=t.entities.ml_category[e].name;return r&&r.toLowerCase()===n.toLowerCase()}));a&&(r=a),r||(r=e[c].category_ids[0])}return r}(n,I);let f;if(s){const e=n.entities.ml_category[s];f=e&&e.url_slug,R.classList.add("lux-FilterState")}if(c&&f&&(h.bannerFollowingSibling||h.bannerPrecedingSibling)){u.debug("Initialize category banner feature");const e=(()=>{const e=n.responses.category_search,t=e[Object.keys(e)[0]],r=t.category_ids.indexOf(s),o=(t.spec_filters_list||[])[r]||[];return o.length?`&spec_filters=${encodeURIComponent(JSON.stringify(o))}`:E.get("spec_filters")?`&spec_filters=${encodeURIComponent(E.get("spec_filters"))}`:""})(),t=V(s,n)?"parent_category":"category",c=await Object(r.a)()?"&ext_usr_ps=true":"";let a;N(".lux-Banner");const i=Object(o.f)("div",{class:"lux-Banner lux-FrameContainer",styles:h.bannerContainerStyles},[Object(o.f)("div",{class:"lux-FrameLoadingImage"},[Object(o.f)("img",{src:chrome.runtime.getURL("/assets/images/logo-load-in.gif")})]),a=Object(o.f)("iframe",{class:"lux-Banner-Frame",src:`${m}/plugin/${t}?category_name=${f}${e}&store=${l}${c}`,id:"lux-category-banner",title:"Lustre category banner"})]);if(a.addEventListener("load",(e=>{A(a),i.classList.add("loaded")})),u.debug("Attach category banner feature"),O(i,{precedingNode:R.querySelector(h.bannerPrecedingSibling),followingNode:R.querySelector(h.bannerFollowingSibling)}),Object(r.f)("category banner shown",{eventCategory:`${l} ${d}`,eventLabel:f,categoryName:f,searchQuery:I,searchParam:I}),h.disableButtonFollowingSibling||h.disableButtonPrecedingSibling){let e;u.debug("Initialize disable button feature");const t=Object(o.f)("div",{class:"lux-DisableButton",styles:h.disableButtonContainerStyles,"data-testid":"disable-banner-button"},[document.createTextNode(`Disable Lustre on ${h.displayName}`),e=Object(o.f)("div",{class:"lux-DisableButton-Target","data-testid":"disable-banner-button-target"},[Object(o.f)("img",{class:"lux-DisableButton-Icon lux-DisableButton-Icon_noHover",src:chrome.runtime.getURL("/assets/images/icons/close.svg")}),Object(o.f)("img",{class:"lux-DisableButton-Icon lux-DisableButton-Icon_hover",src:chrome.runtime.getURL("/assets/images/icons/close-solid.svg")})])]);u.debug("Attach disable button feature"),O(t,{precedingNode:R.querySelector(h.disableButtonPrecedingSibling),followingNode:R.querySelector(h.disableButtonFollowingSibling)}),e.addEventListener("click",(e=>{Object(r.e)("add_disabled_site",{domain:g}),P(),Object(r.f)("clicked disable on site button",{eventCategory:`${l} ${d}`,eventLabel:l,siteName:l,categoryName:f,searchParam:I})}))}}if(y&&(s||i)&&h.searchPrice){u.debug("Initialize search page badge feature");const e=e=>e.closest(".a-row");let n=[...R.querySelectorAll(".a-price, .a-color-price")].filter(e);const c=n.map(H),i=a()(n.map(e)),p=Object(r.c)(t,"product_id_lookup",Object(o.a)(c,"product_id_lookup")).then((e=>{i.forEach((t=>{if(t&&!t.querySelector(".lux-Button")){const r=t.getAttribute("class");t.setAttribute("class",`${r} lux-ButtonContainer`);const c=H(t),a=c?Object(o.b)(c):null,i=e.responses.product_id_lookup,s=a?i[a].product_type_id:null;if(s){const e=((n=J(s,a)).classList.add("lux-FilterState-Hideable"),n.classList.add("lux-FilterState-Hideable_onEnable"),n);O(e,{parentNode:t})}}var n}))})),g=Object(r.c)(t,"product_scores_lookup",Object(o.a)(c,"product_scores_lookup"));Promise.all([p,g]).then((([e,t])=>{W(t),G(t,s),i.forEach((e=>{if(e){const n=e.querySelector(".lux-Button");if(n){const r=n.getAttribute("data-id"),o=t.responses.product_scores_lookup[r].product_type_id,c=X(r,t,s);let a=f;if(c){const e=c.ml_category_id,n=t.entities.ml_category[e];n&&(a=n.url_slug)}const i=e.querySelector(".a-offscreen");let u;i&&(u=i.textContent.replace(/\D/g,""));const l=c&&c.is_winner,d=c&&c.score;d?Q(n,a,o,u,null,l,d):n.remove()}}})),u.debug("Attach search page badge feature"),i.find((e=>e&&e.querySelector(".lux-Button")))&&Object(r.f)("product badges shown",{eventCategory:`${l} ${d}`,eventLabel:f,categoryName:f,searchParam:I})}))}}if(B&&"product"===d){u.debug("Initialize product page features");const e=document.getElementById("priceblock_dealprice")||document.getElementById("priceblock_ourprice")||document.getElementById("priceblock_saleprice")||document.getElementById("price_inside_buybox");let n=null;if(e){const t=e.textContent.trim();n=parseFloat(t.replace(/[$,]/g,""))}const c=U(location.pathname);if(c){let e={[c]:{sku:c,store:l,price:n}};if(Object(r.e)("set_products",{products:e}),_){u.debug("Initialize product info feature");let e=E.get("category_name");const a={store:l,product_sku:c},i=Object(o.a)([a],"product_scores_lookup"),s=Object.keys(i.queries.product_scores_lookup)[0],f=Object(r.c)(t,"product_scores_lookup",i),p=await f;let g=(Object.values(p.entities.ml_category).find((t=>t.url_slug===e))||{}).ml_category_id;const _=p.responses.product_scores_lookup,y=X(s,p,g);if(y&&!e&&(g=y.ml_category_id,e=p.entities.ml_category[g].url_slug),W(p),G(p,g),y&&(null!==y.score||b)){const t=document.querySelector('[data-feature-name="featurebullets"]'),a=t.clientWidth>=300?t:document.querySelector("#hover-zoom-end"),i=_[s].product_type_id,f=`&category_name=${e}`,p=`product_node_id=${i}`,g=E.get("price_intent"),b=g?`&price_intent=${g}`:"",y=E.get("product_price")||n&&Math.floor(100*n).toString(),h=y?`&product_price=${y}`:"",v=E.get("spec_filters")?`&spec_filters=${encodeURIComponent(E.get("spec_filters"))}`:"",x=await Object(r.a)()?"&ext_usr_ps=true":"";let w,S;N(".lux-ProductInfo");const j=Object(o.f)("div",{class:"lux-ProductInfo"},[w=J(i,s),Object(o.f)("div",{class:"lux-ProductSnippet lux-FrameContainer"},[Object(o.f)("div",{class:"lux-FrameLoading"},[Object(o.f)("img",{src:chrome.runtime.getURL("/assets/images/icons/logo.svg"),class:"lux-ModalLoading-Heart lux-ModalLoading-Heart_medium"})]),S=Object(o.f)("iframe",{class:"lux-ProductSnippet-Frame"+(e?"":" lux-ProductSnippet-Frame_collapsed"),style:"opacity: 0;",src:`${m}/plugin/product?${p}${f}${b}${h}&store=${l}${v}${x}`,id:"lux-product-snippet",title:"Lustre product snippet"})])]),L=["lux-ProductSnippet-Button","lux-Button_noHover"];w.classList.add(...L),u.debug("Attach product info feature"),O(j,{followingNode:a}),Object(r.f)("product info shown",{eventCategory:`${l} ${d}`,eventLabel:e,categoryName:e,productNodeId:i,productSku:c}),S.addEventListener("load",(e=>{A(S)}))}else u.debug("Product info category not found")}}}if(q&&"cart"===d){u.debug("Initialize cart page features");let e=[...q.querySelectorAll("[data-asin]")].reduce(((e,t)=>{let n=t.getAttribute("data-asin"),r=t.getAttribute("data-price");const o=parseFloat(r.replace(/[$,]/g,""));return e[n]={sku:n,store:l,price:o},e}),{});Object(r.e)("set_products",{products:e});const n=Object.keys(e).map((e=>({store:l,product_sku:e}))),c=Object(o.a)(n,"product_scores_lookup"),a=Object(r.c)(t,"product_scores_lookup",c),i=await a;W(i)}if(D&&"thankyou"===d){u.debug("Initialize thankyou page features");const e=M?[...M.querySelectorAll("a[href]")].flatMap((e=>{const t=U(e.href);return t||[]})):[],t=E.getAll("orderId"),n=E.getAll("purchaseId");Object(r.e)("check_order",{skus:e,orderIds:t,purchaseIds:n}).then((t=>{t||(Object(r.f)("thankyou page",{eventCategory:`${l} ${d}`,skus:e}),e.forEach((e=>Object(r.e)("set_purchase",{sku:e}))))}))}};let T=location.href;chrome.runtime.onMessage.addListener((e=>{switch(e.type&&u.debug(`Received background message: ${e.type}`,e),e.type){case"tab_updated":location.href!==T&&(u.debug(`Soft transition detected: ${T} to ${location.href}`),T=location.href,I().catch(f))}})),window.addEventListener("message",(e=>{if(e.data)switch(e.data.type&&u.debug(`Received window message: ${e.data.type}`,e.data),e.data.type){case"getDimensions":!function(e){const t=document.querySelector(`iframe[src="${e.data.source}"]`);t.style.height=`${t.clientHeight}px`,setTimeout((()=>{t.style.height=`${e.data.height}px`,t.style.opacity="1"}),0)}(e);break;case"attachModal":E(e);break;case"removeModal":$(e);break;case"replaceModal":!function(e){if(L){const t=L.querySelector("iframe.lux-Modal-Frame");if(t)return void t.setAttribute("src",e.data.url)}E(e)}(e);break;case"navigateToAmazonSearch":const{query:t}=e.data;if(!t)break;!function(e){const t=Object(o.e)(e);window.location.href=t}(t);break;case"applyFilters":!function(e){const t=[...document.querySelectorAll('iframe[src*="/plugin/"]')],n=e.data.specFilters;t.forEach((e=>{e.contentWindow.postMessage({type:"applyFilters",specFilters:n},"*")}));const r=document.querySelectorAll(".lux-FilterState");n.length?r.forEach((e=>{e.classList.add("lux-FilterState_enabled")})):r.forEach((e=>{e.classList.remove("lux-FilterState_enabled")}))}(e)}else u.debug("Received unknown window message",e)})),document.addEventListener("click",j,{capture:!0}),I().catch(f)})().catch(f)},function(e,t,n){var r=n(110),o=n(111),c=n(112),a=n(113),i=n(193),s=n(114);e.exports=function(e,t,n){var u=-1,l=o,d=e.length,f=!0,p=[],g=p;if(n)f=!1,l=c;else if(d>=200){var _=t?null:i(e);if(_)return s(_);f=!1,l=a,g=new r}else g=t?[]:p;e:for(;++u<d;){var b=e[u],y=t?t(b):b;if(b=n||0!==b?b:0,f&&y==y){for(var h=g.length;h--;)if(g[h]===y)continue e;t&&g.push(y),p.push(b)}else l(g,y,n)||(g!==p&&g.push(y),p.push(b))}return p}},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var r=n(190),o=n(191),c=n(192);e.exports=function(e,t,n){return t==t?c(e,t,n):r(e,o,n)}},function(e,t){e.exports=function(e,t,n,r){for(var o=e.length,c=n+(r?1:-1);r?c--:++c<o;)if(t(e[c],c,e))return c;return-1}},function(e,t){e.exports=function(e){return e!=e}},function(e,t){e.exports=function(e,t,n){for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}},function(e,t,n){var r=n(84),o=n(194),c=n(114),a=r&&1/c(new r([,-0]))[1]==1/0?function(e){return new r(e)}:o;e.exports=a},function(e,t){e.exports=function(){}},function(e,t,n){var r=n(110),o=n(111),c=n(112),a=n(34),i=n(38),s=n(113),u=Math.min;e.exports=function(e,t,n){for(var l=n?c:o,d=e[0].length,f=e.length,p=f,g=Array(f),_=1/0,b=[];p--;){var y=e[p];p&&t&&(y=a(y,i(t))),_=u(y.length,_),g[p]=!n&&(t||d>=120&&y.length>=120)?new r(p&&y):void 0}y=e[0];var h=-1,m=g[0];e:for(;++h<d&&b.length<_;){var v=y[h],x=t?t(v):v;if(v=n||0!==v?v:0,!(m?s(m,x):l(b,x,n))){for(p=f;--p;){var O=g[p];if(!(O?s(O,x):l(e[p],x,n)))continue e}m&&m.push(x),b.push(v)}}return b}},function(e,t,n){var r=n(48),o=n(88),c=n(90);e.exports=function(e,t){return c(o(e,t,r),e+"")}},function(e,t,n){var r=n(198);e.exports=function(e){return r(e)?e:[]}},function(e,t,n){var r=n(47),o=n(19);e.exports=function(e){return o(e)&&r(e)}},function(e,t,n){}]);
//# sourceMappingURL=content.js.map