{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/utils.js","webpack:///./node_modules/hash-sum/hash-sum.js","webpack:///./src/components/popup/popup.js","webpack:///./src/components/messages.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","makeElement","type","attributes","childNodes","element","document","createElement","attributeKey","attributeValue","styleKey","style","setProperty","setAttribute","forEach","node","appendChild","makeAmazonSearchUrl","query","replace","getAmazonLinkInfo","host","pathname","search","domain","match","RegExp","test","ref","getPageType","selectors","find","pageType","path","isPathMatching","location","container","querySelector","requirements","every","requirement","generateQueryKey","buildQueryBundle","queries","queryType","bundle","queryKey","setLogPrefix","log","prefixString","logFactory","methodFactory","methodName","logLevel","loggerName","rawMethod","message","setLevel","getLevel","fold","hash","text","len","length","charCodeAt","foldValue","input","seen","toString","undefined","indexOf","push","objHash","keys","sort","reduce","foldObject","valueOf","String","err","stack","pad","addEventListener","async","SITE_HOSTNAME","ALLOW_DISABLED_CATEGORIES","loadingImage","src","chrome","runtime","getURL","class","isAllCategories","popupIframe","styles","height","width","window","event","data","amazonUrl","tabs","url","close","sendMessage","params","Promise","resolve","reject","result","loadQuery","queryName","queryBundle","searchCategory","searchParam","loadFullConfig","track","args","arguments","getHasPurchased","productCount"],"mappings":"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","file":"popup/popup.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 204);\n","import * as hash from 'hash-sum'\n\nexport const makeElement = function (type, attributes = {}, childNodes = []) {\n  const element = document.createElement(type)\n  for (const attributeKey in attributes) {\n    const attributeValue = attributes[attributeKey]\n    if (attributeKey === 'styles') {\n      for (const styleKey in attributeValue) {\n        element.style.setProperty(styleKey, attributeValue[styleKey])\n      }\n    } else {\n      element.setAttribute(attributeKey, attributeValue)\n    }\n  }\n  childNodes.forEach((node) =>{\n    if (node) {\n      element.appendChild(node)\n    }\n  })\n  return element\n};\n\nexport const makeAmazonSearchUrl = function (query) {\n  query = query.replace(/[\\s]/g, '+')\n  return `https://www.amazon.com/s?k=${query}`\n};\n\nexport const getAmazonLinkInfo = function ({host, pathname, search}) {\n  const domain = (host.match(/[^.]+\\.[^.]+$/) || [])[0]\n  let type = 'external'\n  // Ad URL\n  if (domain === 'amazon-adsystem.com') {\n    type = 'ad'\n  } else\n  // Redirect URL\n  if (domain === 'amazon.com' && new RegExp('^/([^/]*/)?slredirect/').test(pathname)) {\n    type = 'sponsored'\n  } else\n  // Product URL\n  if (domain === 'amazon.com' && new RegExp('^/([^/]*/)?dp/').test(pathname)) {\n    type = 'product'\n  } else\n  // Search URL\n  if (domain === 'amazon.com' && new RegExp('^/s/').test(pathname)) {\n    type = 'search'\n  } else\n  // Category URL\n  if (domain === 'amazon.com' && new RegExp('^/([^/]*/)?b/').test(pathname)) {\n    type = 'category'\n  } else\n  if (domain === 'amazon.com') {\n    type = 'amazon'\n  }\n  let ref = (pathname.match(/ref=(.+)/) || [])[1]\n  return {\n    type,\n    domain,\n    ref\n  }\n};\n\nexport const getPageType = function (selectors) {\n  const pageTypes = ['home', 'search', 'product', 'cart', 'thankyou']\n  return pageTypes.find((pageType) => {\n    const path = selectors[`${pageType}PagePathRegex`] || null\n    const isPathMatching = location.pathname.match(path) !== null\n    const container = document.querySelector(selectors[`${pageType}PageContainer`])\n    const requirements = selectors[`${pageType}PageRequirements`]\n    if (requirements && (isPathMatching || container)) {\n      return requirements.every((requirement) => {\n        return document.querySelector(requirement)\n      })\n    }\n    return false\n  })\n};\n\nexport const generateQueryKey = function (query) {\n  return hash(query)\n};\n\nexport const buildQueryBundle = function (queries, queryType) {\n  const bundle = {\n    queries: {\n      [queryType]: {},\n    },\n  }\n  queries.forEach((query) => {\n    if (query) {\n      const queryKey = generateQueryKey(query)\n      bundle.queries[queryType][queryKey] = query\n    }\n  })\n  return bundle\n};\n\nexport const setLogPrefix = function (log, prefixString) {\n  const logFactory = log.methodFactory\n  log.methodFactory = function (methodName, logLevel, loggerName) {\n    const rawMethod = logFactory(methodName, logLevel, loggerName)\n    return function (...message) {\n      rawMethod(prefixString, ...message)\n    }\n  }\n  log.setLevel(log.getLevel())\n};\n","'use strict';\n\nfunction pad (hash, len) {\n  while (hash.length < len) {\n    hash = '0' + hash;\n  }\n  return hash;\n}\n\nfunction fold (hash, text) {\n  var i;\n  var chr;\n  var len;\n  if (text.length === 0) {\n    return hash;\n  }\n  for (i = 0, len = text.length; i < len; i++) {\n    chr = text.charCodeAt(i);\n    hash = ((hash << 5) - hash) + chr;\n    hash |= 0;\n  }\n  return hash < 0 ? hash * -2 : hash;\n}\n\nfunction foldObject (hash, o, seen) {\n  return Object.keys(o).sort().reduce(foldKey, hash);\n  function foldKey (hash, key) {\n    return foldValue(hash, o[key], key, seen);\n  }\n}\n\nfunction foldValue (input, value, key, seen) {\n  var hash = fold(fold(fold(input, key), toString(value)), typeof value);\n  if (value === null) {\n    return fold(hash, 'null');\n  }\n  if (value === undefined) {\n    return fold(hash, 'undefined');\n  }\n  if (typeof value === 'object' || typeof value === 'function') {\n    if (seen.indexOf(value) !== -1) {\n      return fold(hash, '[Circular]' + key);\n    }\n    seen.push(value);\n\n    var objHash = foldObject(hash, value, seen)\n\n    if (!('valueOf' in value) || typeof value.valueOf !== 'function') {\n      return objHash;\n    }\n\n    try {\n      return fold(objHash, String(value.valueOf()))\n    } catch (err) {\n      return fold(objHash, '[valueOf exception]' + (err.stack || err.message))\n    }\n  }\n  return fold(hash, value.toString());\n}\n\nfunction toString (o) {\n  return Object.prototype.toString.call(o);\n}\n\nfunction sum (o) {\n  return pad(foldValue(0, o, '', []).toString(16), 8);\n}\n\nmodule.exports = sum;\n","import { loadFullConfig } from '../messages'\nimport { makeElement, makeAmazonSearchUrl } from '../utils'\n\ndocument.addEventListener('DOMContentLoaded', async function () {\n  const {\n    SITE_HOSTNAME,\n    ALLOW_DISABLED_CATEGORIES,\n  } = await loadFullConfig()\n\n  const loadingImage = makeElement('img', {\n    src: chrome.runtime.getURL('/assets/images/icons/logo.svg'),\n    class: 'lux-ModalLoading-Heart',\n  })\n  document.querySelector('.lux-FrameLoading').appendChild(loadingImage)\n\n  const isAllCategories = ALLOW_DISABLED_CATEGORIES ? 'all_categories=true' : ''\n  const popupIframe = makeElement('iframe', {\n    src: `${SITE_HOSTNAME}/plugin/mainPopup?${isAllCategories}`,\n    class: 'lux-Popup-Frame',\n    styles: {\n      height: '450px',\n      width: '300px',\n    }\n  })\n  document.querySelector('body').appendChild(popupIframe)\n\n  window.addEventListener('message', (event) => {\n    switch (event.data.type) {\n      case 'navigateToAmazonSearch':\n        const { query } = event.data\n        if (!query) {\n          break\n        }\n        const amazonUrl = makeAmazonSearchUrl(query)\n        chrome.tabs.create({ url: amazonUrl })\n        window.close()\n        break\n    }\n  })\n})\n","export const sendMessage = function (type, params) {\n  return new Promise((resolve, reject) => {\n    chrome.runtime.sendMessage({\n      type,\n      ...params,\n    }, (result) => {\n      resolve(result)\n    })\n  })\n}\n\nexport const loadQuery = function (host, queryName, queryBundle) {\n  return sendMessage('load_query', { host, queryName, queryBundle })\n};\n\nexport const searchCategory = function (searchParam) {\n  return sendMessage('category_search', { searchParam })\n};\n\nexport const loadFullConfig = function () {\n  return sendMessage('get_config')\n};\n\nexport const track = function (...args) {\n  sendMessage('track', {arguments: args})\n};\n\nexport const getPurchaseMeta = function () {\n  return sendMessage('get_purchase_meta')\n};\n\nexport const getHasPurchased = async function () {\n  const { productCount } = await getPurchaseMeta()\n  return productCount && productCount > 0\n};\n"],"sourceRoot":""}